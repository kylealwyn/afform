
/**
 * Automatically validate your forms using the HTML5 builtin methods
 *
 * Afform - the best way to validate a form
 * @version v1.0.0
 * @link https://github.com/kylealwyn/afform
 * @license MIT
 *
 * Copyright (c) 2016 @kylealwyn
 * The MIT License. Copyright Â© 2016 Kyle Alwyn.
 */

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!Array.isArray(e)}function r(e,i){if(t(e)&&t(i))for(var o in i)t(i[o])?(e[o]||Object.assign(e,_defineProperty({},o,{})),r(e[o],i[o])):Object.assign(e,_defineProperty({},o,i[o]));return e}"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),e.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,r=(this.document||this.ownerDocument).querySelectorAll(e),i=this;do for(t=r.length;--t>=0&&r.item(t)!==i;);while(0>t&&(i=i.parentElement));return i});var i={ValidationsAttribute:"data-validations",FormGroupClass:"form-group",ErrorElementClass:"afform-error",ErrorModifierClass:"has-error",DefaultMessages:{badInput:"This field is incorrect.",patternMismatch:"This pattern is incorrect",rangeOverflow:"This field is too large",rangeUnderflow:"This field is too small",stepMismatch:"This field is out of step",tooLong:"This field is too long",tooShort:"This field is too short",typeMismatch:"This field has an incorrect type",valueMissing:"This field is required"},onValid:function(){},onError:function(){}},o=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.form=t,this.form.setAttribute("novalidate","novalidate"),this.formFields=[].slice.call(this.form.elements),this.config=r({},e.defaults,i),this.subscribe()}return _createClass(e,[{key:"subscribe",value:function(){var e=this;this.form.addEventListener("submit",this.onSubmit.bind(this)),this.formFields.forEach(function(t){t.addEventListener("blur",e.validateFormField.bind(e,t))})}},{key:"appendError",value:function(e,t){var r=e.closest("."+this.config.FormGroupClass);if(!r.classList.contains(this.config.ErrorModifierClass)){var i=document.createElement("span");i.classList.add(this.config.ErrorElementClass),i.innerHTML=t,r.classList.add(this.config.ErrorModifierClass),r.appendChild(i)}}},{key:"onSubmit",value:function(e){return this.resetForm(),this.form.checkValidity()?!0:(e.preventDefault(),void this.formFields.forEach(this.validateFormField.bind(this)))}},{key:"validateFormField",value:function(e){var t=e.validity;if(this.resetFormField(e),t.valid)return void this.onValid(e);var i=e.getAttribute(this.config.ValidationsAttribute);i=r({},this.config.DefaultMessages,JSON.parse(i));for(var o in t)t[o]&&(this.onError(e),this.appendError(e,i[o]))}},{key:"resetForm",value:function(){this.formFields.forEach(this.resetFormField.bind(this))}},{key:"resetFormField",value:function(e){var t=e.closest("."+this.config.FormGroupClass);try{t.classList.remove(this.config.ErrorModifierClass),t.querySelector("."+this.config.ErrorElementClass).remove()}catch(e){}}}],[{key:"init",value:function(){var t=[].slice.call(document.querySelectorAll("[gatekeeper]"));t.forEach(function(t){return new e(t)})}},{key:"defaults",get:function(){return i},set:function(t){e.defaults=r({},e.defaults,t)}}]),e}();document.addEventListener("DOMContentLoaded",function(){o.init()}),"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=o:e.Gatekeeper=o}(window);