
/**
 * Automatically validate your forms using the HTML5 builtin methods
 *
 * Afform - the best way to validate a form
 * @version v0.1.1
 * @link https://github.com/kylealwyn/afform
 * @license MIT
 *
 * Copyright (c) 2016 @kylealwyn
 * The MIT License. Copyright Â© 2016 Kyle Alwyn.
 */

"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(e){return e&&"object"===("undefined"==typeof e?"undefined":_typeof(e))&&!Array.isArray(e)}function t(r){if(e(r)){for(var o=arguments.length,i=Array(o>1?o-1:0),n=1;o>n;n++)i[n-1]=arguments[n];i.forEach(function(o){if(e(o))for(var i in o)e(o[i])?(r[i]||Object.assign(r,_defineProperty({},i,{})),t(r[i],o[i])):Object.assign(r,_defineProperty({},i,o[i]))})}return r}var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),r.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,r=(this.document||this.ownerDocument).querySelectorAll(e),o=this;do for(t=r.length;--t>=0&&r.item(t)!==o;);while(0>t&&(o=o.parentElement));return o});var o={FormDataAttribute:"data-afform",ValidationsAttribute:"data-validations",FormGroupClass:"form-group",ErrorElementClass:"afform-error",ErrorModifierClass:"has-error",DefaultMessages:{badInput:"This field is incorrect.",patternMismatch:"This pattern is incorrect",rangeOverflow:"This field is too large",rangeUnderflow:"This field is too small",stepMismatch:"This field is out of step",tooLong:"This field is too long",tooShort:"This field is too short",typeMismatch:"This field has an incorrect type",valueMissing:"This field is required"},onValid:function(){},onError:function(){}},i=function(){function e(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,e),"string"==typeof r?this.form=document.querySelector(r):r instanceof Element&&(this.form=r),!r)throw new Error("Form not found. First argument must be a selector or DOM Node.");this.form=r,this.form.setAttribute("novalidate","novalidate"),this.formFields=[].slice.call(this.form.elements),this.config=t({},e.config,o),this.subscribe()}return _createClass(e,[{key:"subscribe",value:function(){var e=this;this.form.addEventListener("submit",this.onSubmit.bind(this)),this.formFields.forEach(function(t){t.addEventListener("blur",e.validateFormField.bind(e,t))})}},{key:"appendError",value:function(e,t){var r=e.closest("."+this.config.FormGroupClass);if(!r.classList.contains(this.config.ErrorModifierClass)){var o=document.createElement("span");o.classList.add(this.config.ErrorElementClass),o.innerHTML=t,r.classList.add(this.config.ErrorModifierClass),r.appendChild(o)}}},{key:"onSubmit",value:function(e){return this.resetForm(),this.form.checkValidity()?!0:(e.preventDefault(),void this.formFields.forEach(this.validateFormField.bind(this)))}},{key:"validateFormField",value:function(e){var r=e.validity;if(this.resetFormField(e),r.valid)return void this.config.onValid(e);var o=e.getAttribute(this.config.ValidationsAttribute),i=t({},this.config.DefaultMessages,JSON.parse(o));for(var n in r)r[n]&&(this.config.onError(e),this.appendError(e,i[n]))}},{key:"resetForm",value:function(){this.formFields.forEach(this.resetFormField.bind(this))}},{key:"resetFormField",value:function(e){var t=e.closest("."+this.config.FormGroupClass);try{t.classList.remove(this.config.ErrorModifierClass),t.querySelector("."+this.config.ErrorElementClass).remove()}catch(e){}}}],[{key:"setConfig",value:function(r){e.config=t({},o,r)}},{key:"scanAndInit",value:function(){var t=document.querySelectorAll("["+e.config.FormDataAttribute+"]");[].slice.call(t).forEach(function(t){return new e(t)})}}]),e}();i.config=o,"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=i:r.Afform=i,document.addEventListener("DOMContentLoaded",function(){i.scanAndInit()})}(window);